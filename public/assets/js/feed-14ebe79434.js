let scroll_to_top_btn=document.getElementById("scroll-to-top-btn");window.addEventListener("scroll",(function(e){document.documentElement.scrollTop>50?(scroll_to_top_btn.classList.add("fade-opacity"),scroll_to_top_btn.classList.remove("transparent-opacity")):(scroll_to_top_btn.classList.remove("fade-opacity"),scroll_to_top_btn.classList.add("transparent-opacity"))})),scroll_to_top_btn.addEventListener("click",(function(e){document.documentElement.scrollTo({top:0,behavior:"smooth"})}));let newPostForm=$("#new-post-form"),createPost=function(e){return $(`\n    <div class = "post card" id = "${e._id}">\n        <div class = "user-intro">\n            <a href="/users/profile/${e.user._id}" class = "post-user-image-container">\n                <div>\n                    <img class = "circle responsive-img user-image" src = "${e.user.avatar}">\n                </div>\n                <div class = "user-name-time-container">\n                    <h5>${e.user.name}</h5>\n                    <p class = "#e0e0e0 grey-text lighten-2 post-time"><i class="fas fa-globe"></i> ${e.createdAt.toString().substring(0,25)}</p>\n                </div>\n            </a>\n            \n            <div>\n                <i class="fas fa-edit post-dropdown-btn dropdown-trigger waves-effect" data-target = "dropdown-${e._id}"></i>\n                <ul id = "dropdown-${e._id}" class = "dropdown-content">\n                    <li><a href="/posts/destroy/${e._id}" class = "post-delete-link" data-postID = "${e._id}">Delete</a></li>\n                </ul>\n            </div>\n        </div>\n        \n        <hr>\n        <div class = "post-content">\n            ${e.content} \n        </div>\n        <div class = "like-comment-numbers">\n            <div class = "like-numbers">\n                <span class = "like-numbers-count">${e.likes.length}</span> <i class="fas fa-thumbs-up filled-like-btn"></i>\n            </div>\n            <div class = "comment-numbers">\n                <i class = "far fa-comment"></i> <span class = "comment-count">${e.comments.length}</span>\n            </div>\n        </div>\n        <div class = "like-comment-tab row" id = "like-comment-tab">\n            <div class = "col xs6 s6 m6 l6 xl6 center-align waves-effect waves-blue like-btn">\n                <i class = "far fa-thumbs-up"></i> Like\n            </div>\n            <div class = "col xs6 s6 m6 l6 xl6 center-align waves-effect waves-green comment-btn">\n                <i class = "far fa-comment"></i> Comment\n            </div>\n        </div>\n        <div class = "post-comments">\n            <form action = "/comments/create" method = "POST" class = "create-comment">\n                <div class = "input-field">\n                    <input type = "text" name = "content" class = "comment-input-text" placeholder = "Add a comment..." required>\n                </div>\n                <input type = "hidden" name = "post" value = "${e._id}">\n                <button class="btn blue waves-effect waves-light" type="submit">Post\n                    <i class="fa fa-paper-plane" aria-hidden="true"></i>\n                </button>\n            </form>\n\n            <div class = "comments-container">\n\n            </div>\n        </div>\n    </div>\n    `)},newPostFormAction=function(e){e.preventDefault(),$.ajax({type:"post",url:"/posts/create",data:newPostForm.serialize(),success:function(e){$("#feed-posts-container").prepend(createPost(e.data.post)),$("#content").val(""),materializeInit(),successNotification(e)},error:function(e){errorNotification(e,"Post Creation request could not be sent")}})};newPostForm.on("submit",newPostFormAction);let deletePost=function(e){$.ajax({type:"get",url:`/posts/destroy/${e}`,success:function(t){$(`#${e}`).remove(),successNotification(t)},error:function(e){errorNotification(e,"Post deletion request could not be sent")}})};$("#feed-posts-container").on("click",".post-delete-link",(function(e){e.preventDefault(),deletePost(e.target.getAttribute("data-postID"))}));let createComment=function(e){return`\n    <div id = "${e._id}" class = "comment">\n        <a href="/users/profile/${e.user._id}" class = "comment-image-container">\n            <div>\n                <img class = "circle responsive-img user-image" src = "${e.user.avatar}">\n            </div>\n        </a>\n        \n        <div class = "comment-container">\n            <div class = "comment-user-deletebtn-container">\n                <a href="/users/profile/${e.user._id}"><h6>${e.user.name}</h6></a>\n                <i class="comment-dropdown-btn fas fa-chevron-circle-down dropdown-trigger waves-effect" data-target = "dropdown-${e._id}">\n                </i>\n                <ul id = "dropdown-${e._id}" class = "dropdown-content">\n                    <li><a href="/comments/destroy/${e._id}" data-commentID = '${e._id}' class = "comment-delete-link">Delete</a></li>\n                </ul>\n            </div>\n            <p class = "comment-para">${e.content}</p>\n        </div>\n    </div>\n    `},incrementCounter=function(e){e.text(parseInt(e.text())+1),anime({targets:e.parent().get(0),direction:"alternate",scale:1.35,easing:"easeInOutSine",duration:200})},decrementCounter=function(e){e.text(parseInt(e.text())-1),anime({targets:e.parent().get(0),direction:"alternate",scale:1.35,easing:"easeInOutSine",duration:200})},newCommentCreateAction=function(e){$.ajax({type:"post",url:"/comments/create",data:$(e).serialize(),success:function(t){$(e).parent().find(".comments-container").prepend(createComment(t.data.comment)),$(e).find(".comment-input-text").eq(0).val(""),materializeInit(),incrementCounter($(e).parent().parent().find(".comment-count")),successNotification(t)},error:function(e){errorNotification(e,"Comment creation request could not be sent")}})};$("#feed-posts-container").on("submit",".create-comment",(function(e){e.preventDefault(),newCommentCreateAction(e.target)}));let deleteComment=function(e,t){let n=$(t).parent().parent().parent().parent().parent().parent().parent().parent().find(".comment-count");$.ajax({type:"get",url:`/comments/destroy/${e}`,success:function(t){$(`#${e}`).remove(),decrementCounter(n),successNotification(t)},error:function(e){errorNotification(e,"Comment Deletion request could not be sent")}})};$("#feed-posts-container").on("click",".comment-delete-link",(function(e){e.preventDefault();let t=e.target.getAttribute("data-commentID");deleteComment(t,e.target)}));let likePost=function(e){$.ajax({type:"put",url:`/likes/toggle?type=Post&id=${e.attr("id")}`,success:function(e){},error:function(e){errorNotification(e,"Internal Server Error!")}})};$("#feed-posts-container").on("click",".like-btn",(function(e){"I"==e.target.tagName&&(e.target=e.target.parentElement);let t=$(e.target).parent().parent().find(".like-numbers-count"),n=$(e.target).find("i"),s=$(e.target).parent().parent();$(e.target).hasClass("liked")?(t.text(parseInt(t.text())-1),$(e.target).removeClass("liked"),n.removeClass("fas"),n.addClass("far")):(t.text(parseInt(t.text())+1),$(e.target).addClass("liked"),n.removeClass("far"),n.addClass("fas")),anime({targets:e.target.querySelector("i"),direction:"alternate",scale:1.35,easing:"easeInOutSine",duration:200}),likePost(s)}));